local vehs = {
    {
        label = "Annis",
        vehs = {
            {maker = "Annis", price = 235000, label = "Remus Tsuki Edition", model = "tfremus"},
            {maker = "Annis", price = 68500, label = "Euros X32 Custom", model = "eurosx32wb"},
            {maker = "Annis", price = 35000, label = "Euros", model = "euros"},
            {maker = "Annis", price = 18000, label = "kawaii", model = "kawaii"},
            {maker = "Annis", price = 30000, label = "Roxanne", model = "roxanne"},
            {maker = "Annis", price = 120000, label = "ZR380 R", model = "zr380c"},
            {maker = "Annis", price = 115000, label = "ZR380 RS", model = "zr380s"},
            {maker = "Annis", price = 13500, label = "Elegy RH4", model = "rh4"},
            {maker = "Annis", price = 45000, label = "s-230", model = "S230"},
            {maker = "Annis", price = 23500, label = "ZR-250", model = "ZR250"},
            {maker = "Annis", price = 65000, label = "ZR-350", model = "ZR"},
            {maker = "Annis", price = 185000, label = "Elegy RH8 FR-Works", model = "rh82"},
            {maker = "Annis", price = 145000, label = "ZR390", model = "ZR390"},
            {maker = "Annis", price = 15000, label = "Elegy Retro Ute", model = "ELEGY"},
            {maker = "Annis", price = 45000, label = "Elegy RH-7", model = "ELEGYRH7"},
            {maker = "Annis", price = 1850000, label = "Majima LM", model = "MAJIMALM"},
            {maker = "Annis", price = 16500, label = "Remus Cabrio", model = "REMUSVERT"},
            {maker = "Annis", price = 1000000, label = "Cardboard Bozozoku", model = "BOZOCARD"},
            {maker = "Annis", price = 24500, label = "Remus Pickup", model = "REMUSP"},
            {maker = "Annis", price = 33500, label = "Trailwilder", model = "TRAILW"},
        }
    },
    {
        label = "Albany",
        vehs = {
            {maker = "Albany", price = 70000, label = "Cavalcade III", model = "NCAVALCADE"},
            {maker = "Albany", price = 33500, label = "Primo LX", model = "PRIMOLX"},
            {maker = "Albany", price = 14500, label = "Esperanto", model = "ESPERANTO"},
            {maker = "Albany", price = 17500, label = "Esperanto Executive", model = "ESPEXECUTIVE"},
            {maker = "Albany", price = 19500, label = "Primo ARD", model = "PRIMOARD"},
        }
    },
    {
        label = "Benefactor",
        vehs = {
            {maker = "Benefactor", price = 43500, label = "Benefactor Schafter V12", model = "SCHAFTER3RS"},
            {maker = "Benefactor", price = 335000, label = "Benefactor kriegerc", model = "kriegerc"},
            {maker = "Benefactor", price = 675000, label = "Benefactor Glendale Strech", model = "glendalelimo"},
            {maker = "Benefactor", price = 93500, label = "Benefactor streiter v2", model = "streiter2"},
            {maker = "Benefactor", price = 63500, label = "Benefactor spritzer", model = "spritzer"},
            {maker = "Benefactor", price = 94500, label = "Benefactor spritzer STM", model = "spritzerdtm"},
            {maker = "Benefactor", price = 265000, label = "Benefactor Schlagen STR", model = "SCHLAGENSTR"},
            {maker = "Benefactor", price = 665000, label = "Benefactor Schwartzer DTM", model = "SCDTM"},
            {maker = "Benefactor", price = 845000, label = "Benefactor Surano E-Motion", model = "SURANOE"},
        }
    },
    {
        label = " Bravado",
        vehs = {
            {maker = " Bravado", price = 33500, label = "Lazyeye Gauntlet", model = "yubbynub"},
            {maker = " Bravado", price = 66500, label = "Bravado Gauntlet Hellfire Last Call", model = "HELLFIRELASTCALL"},
            {maker = " Bravado", price = 85000, label = "Bravado Hellfire", model = "buffalo4h"},
            {maker = " Bravado", price = 47500, label = "Bravado Gauntlet v2", model = "gauntletc"},
            {maker = " Bravado", price = 82500, label = "Bravado Gauntlet STX", model = "gauntletstx"},
            {maker = " Bravado", price = 63500, label = "Bravado Vulture", model = "vulture"},
            {maker = " Bravado", price = 88500, label = "Bravado Howitzer", model = "HOWITZER"},
            {maker = " Bravado", price = 93500, label = "Bravado Howitzer v2", model = "HOWITZER2"},
            {maker = " Bravado", price = 11350, label = "Bravado Gresley Hellhound", model = "GRESLEYH"},
            {maker = " Bravado", price = 45000, label = "Boxville Bravado MBU", model = "servicevan"},
            {maker = "Bravado", price = 80000, label = "Buffalo Street", model = "sabuffalostreet"},
            {maker = "Bravado", price = 135000, label = "Buffalo Gauntlet Street", model = "sagauntletstreet"},
        }
    },
    {
        label = "BF",
        vehs = {
            {maker = "BF", price = 12300, label = "BF Club racing", model = "CLUBTA"},
            {maker = "BF", price = 2350000, label = "BF Ruff-Weld Weevil", model = "weevilf6"},
        }
    },
    {
        label = " BORDEAUX",
        vehs = {
            {maker = " BORDEAUX", price = 85000, label = "BORDEAUX ARIAS", model = "arias"},
            {maker = " BORDEAUX", price = 33500, label = "Bordeaux SP3 Mirage", model = "Mirage"},
        }
    },
    {
        label = "COIL",
        vehs = {
            {maker = "COIL", price = 43000, label = "Coil Raiden Z", model = "RAIDENZ"},
        }
    },
    {
        label = "Chariot",
        vehs = {
            {maker = "Chariot", price = 43500, label = "Chariot Romero Hearse Widebody", model = "ROMTUNER"},
        }
    },
    {
        label = "Cheval",
        vehs = {
            {maker = "Cheval", price = 33500, label = "Cheval picadorexr", model = "picadorexr"},
        }
    },
    {
        label = "coquette",
        vehs = {
            {maker = "coquette", price = 76500, label = "coquette 4c", model = "coquette4c"},
        }
    },
    {
        label = "Declasse",
        vehs = {
            {maker = "Declasse", price = 86500, label = "Declasse Granger 3600UT", model = "h4rxgranUT"},
            {maker = "Declasse", price = 28500, label = "Declasse Indiana", model = "indiana"},
            {maker = "Declasse", price = 33500, label = "Declasse Indiana XL", model = "indianaxl"},
            {maker = "Declasse", price = 12850, label = "1991 Declasse Premier", model = "91prem"},
            {maker = "Declasse", price = 24500, label = "Declasse Walton v1", model = "l35r"},
            {maker = "Declasse", price = 19500, label = "Declasse Walton v2", model = "l35s"},
            {maker = "Declasse", price = 33500, label = "Declasse Burritor", model = "burritor"},
            {maker = "Declasse", price = 64500, label = "Declasse Yosemite Raid", model = "gstyosemite1"},
            {maker = "Declasse", price = 135000, label = "Declasse Tampa X wildbody", model = "TAMPAX"},
            {maker = "Declasse", price = 22800, label = "Declasse Premier 200 SS", model = "TMPREM"},
        }
    },
    {
        label = "DINKA",
        vehs = {
            {maker = "DINKA", price = 13500, label = "Dinka Peanut", model = "peanut"},
            {maker = "DINKA", price = 53500, label = "Dinka Blista Kanjo Rally", model = "kanjor"},
            {maker = "DINKA", price = 165000, label = "Dinka Jester re-RR", model = "JESTGPR"},
            {maker = "DINKA", price = 41500, label = "Dinka Millennial Wagon", model = "MILLENNIAL"},
            {maker = "DINKA", price = 235000, label = "Dinka Nexus", model = "NEXUS"},
            {maker = "Dinka", price = 350000, label = "Cavos V6 WideBody", model = "chavosv6w"},
            {maker = "dINKA", price = 185000, label = "Jester MK4 Custom", model = "jester3c"},
        }
    },
    {
        label = "Enus",
        vehs = {
            {maker = "Enus", price = 365000, label = "Enus Windsor GP Kit", model = "h4rxwindsorcus"},
            {maker = "Enus", price = 245000, label = "ENUS Paragon XR", model = "paragonxr"},
        }
    },
    {
        label = "Emperor",
        vehs = {
            {maker = "Emperor", price = 31500, label = "Emperor Sheavas", model = "sheavas"},
        }
    },
    {
        label = "Grotti",
        vehs = {
            {maker = "Grotti", price = 185000, label = "Grotti Stinger SC", model = "stingersc"},
            {maker = "Grotti", price = 225000, label = "grotti Cheetah Fel", model = "cheetahfel"},
            {maker = "Grotti", price = 375000, label = "Grotti itali gts", model = "italigts"},
            {maker = "Grotti", price = 1400000, label = "Grotti Turismo Classic Custom", model = "turismoc"},
            {maker = "Grotti", price = 285000, label = "Grotti Itali GTO N-Larga Custom", model = "ITALIGTON"},
        }
    },
    {
        label = "gallivanter",
        vehs = {
            {maker = "gallivanter", price = 135000, label = "gallivanter baller RAID", model = "baller7r"},
        }
    },
    {
        label = "hijak",
        vehs = {
            {maker = "hijak", price = 10000, label = "hijak EVA", model = "eva"},
        }
    },
    {
        label = "Iemanjá",
        vehs = {
            {maker = "Iemanjá", price = 10000, label = "Iemanjá Carumba", model = "CARUMBA"},
        }
    },
    {
        label = "Imponte",
        vehs = {
            {maker = "Imponte", price = 18500, label = "Imponte Duke 450 cui", model = "dukes4"},
            {maker = "Imponte", price = 28500, label = "Imponte Ruiner 450 Custom", model = "ruiner6str"},
            {maker = "Imponte", price = 32500, label = "Imponte Ruiner UTE", model = "ruinerafd"},
            {maker = "Imponte", price = 63500, label = "Imponte Firecast Phoenix", model = "FIRECAST"},
            {maker = "Imponte", price = 44500, label = "Imponte Deluxo GT", model = "DELUXOGT"},
        }
    },
    {
        label = "KARIN",
        vehs = {
            {maker = "KARIN", price = 13500, label = "Karin atlas", model = "atlas"},
            {maker = "KARIN", price = 67500, label = "Karin Sultan RSV8 MK2", model = "SULTANRSV8"},
            {maker = "KARIN", price = 135000, label = "Karin Futo Custom", model = "FUTOPE"},
            {maker = "KARIN", price = 83500, label = "Karin Ariant", model = "ARIANT"},
            {maker = "KARIN", price = 99500, label = "Karin Boor Widebody", model = "BOORC"},
            {maker = "KARIN", price = 279500, label = "Karin Drift Rebel", model = "REBELD"},
            {maker = "KARIN", price = 65000, label = "Karin Futo Hatchback N2 Spec", model = "N2FUTO"},
            {maker = "KARIN", price = 1150000, label = "Karin R70K-II", model = "R70K"},
            {maker = "KARIN", price = 85000, label = "Karin Sultan Backyard Boost", model = "SULBOOST"},
            {maker = "KARIN", price = 115000, label = "Karin Sultan Classic Custom", model = "SULTAN2C"},
            {maker = "KARIN", price = 22500, label = "Karin Turtle", model = "turtle"},
            {maker = "KARIN", price = 33500, label = "Karin Sultan Tubular", model = "KTUBE"},
            {maker = "KARIN", price = 95000, label = "Karin Rebel Raid", model = "REBELR"},
            {maker = "KARIN", price = 16500, label = "Karin Sultan Drift Missile", model = "SULTANDM"},
        }
    },
    {
        label = "Lampadati",
        vehs = {
            {maker = "Lampadati", price = 22500, label = "Lampadati Panorama", model = "panorama"},
            {maker = "Lampadati", price = 67500, label = "Lampadati Komoda FR-Works", model = "KOMODAFR"},
        }
    },
    {
        label = "Maibatsu",
        vehs = {
            {maker = "Maibatsu", price = 49500, label = "Maibatsu Sunrise VII", model = "sunrise1"},
            {maker = "Maibatsu", price = 22500, label = "Maibatsu Penumbra Retro", model = "PENTRO"},
            {maker = "Maibatsu", price = 63500, label = "Maibatsu Vincent Sport", model = "VINCENT2"},
            {maker = "Maibatsu", price = 93500, label = "Maibatsu Vincent Tourer", model = "VINCENT3"},
        }
    },
    {
        label = "MAXWELL",
        vehs = {
            {maker = "MAXWELL", price = 110000, label = "Maxwell Molecule", model = "MOLECULE"},
        }
    },
    {
        label = "OBEY",
        vehs = {
            {maker = "OBEY", price = 165000, label = "Obey 9R", model = "NINER"},
            {maker = "OBEY", price = 83500, label = "Obey Argento", model = "ARGENTO"},
            {maker = "OBEY", price = 9850, label = "Obey DD-BLITZ", model = "DOUBLED"},
        }
    },
    {
        label = "Overflod",
        vehs = {
            {maker = "Overflod", price = 1800000, label = "Entity MTR", model = "H4REntityMTR"},
        }
    },
    {
        label = "ORACLE",
        vehs = {
            {maker = "ORACLE", price = 37500, label = "Oracle V12", model = "ORACLETA"},
            {maker = "ORACLE", price = 97500, label = "Oracle V12 std", model = "ORACLESTD"},
        }
    },
    {
        label = "Ocelot",
        vehs = {
            {maker = "Ocelot", price = 35000, label = "Ocelot 620s", model = "f620s2"},
        }
    },
    {
        label = "Patriot",
        vehs = {
            {maker = "Patriot", price = 135000, label = "Patriot squaddier Raid", model = "squaddier"},
        }
    },
    {
        label = "Pfister",
        vehs = {
            {maker = "Pfister", price = 235000, label = "Pfister Comet RR", model = "cometrr"},
            {maker = "Pfister", price = 375000, label = "Pfister Comet S2 SCW", model = "comet6scw"},
            {maker = "Pfister", price = 195000, label = "Pfister Meteor", model = "meteor"},
            {maker = "Pfister", price = 650000, label = "Pfister Stardust", model = "stardust"},
            {maker = "Pfister", price = 995000, label = "Pfister Comet S2 CUP", model = "cometcup"},
        }
    },
    {
        label = "Progen",
        vehs = {
            {maker = "Progen", price = 635000, label = "Progen Ares GT", model = "ares"},
            {maker = "Progen", price = 475000, label = "Progen Emerus GTR", model = "EMERUSGTR"},
            {maker = "Progen", price = 275000, label = "Progen MF1 Spyder", model = "MF1"},
            {maker = "Progen", price = 275000, label = "Progen MF1 Spyder v2", model = "MF1C"},
        }
    },
    {
        label = "Pegassi",
        vehs = {
            {maker = "Pegassi", price = 650000, label = "Pegassi Osiris Roadster", model = "OSIRISR"},
            {maker = "Pegassi", price = 375000, label = "Pegassi Tempesta Evo Stradale", model = "TEMPESTAES"},
            {maker = "Pegassi", price = 475000, label = "Pegassi Tempesta Custom", model = "tempesta2"},
            {maker = "Pegassi", price = 850000, label = "Pegassi Tempesta FR-Works", model = "TEMPESTAFR"},
            {maker = "Pegassi", price = 650000, label = "Pegassi Torero Custom", model = "TOREROD"},
            {maker = "Pegassi", price = 1375000, label = "Severo Widebody", model = "saseverowb"},
        }
    },
    {
        label = "Schyster",
        vehs = {
            {maker = "Schyster", price = 63500, label = "Schyster Fusilade V8", model = "FUSILADEV8"},
        }
    },
    {
        label = "Ubermacht",
        vehs = {
            {maker = "Ubermacht", price = 27500, label = "Übermacht Beretta", model = "BERETTA"},
            {maker = "Ubermacht", price = 33500, label = "Übermacht sentinelsg4", model = "sentinelsg4"},
            {maker = "Ubermacht", price = 27500, label = "Übermacht Zion 750ci", model = "zion4"},
            {maker = "Ubermacht", price = 44500, label = "Ubermacht Cypher Hatchback", model = "CYPHERCT"},
            {maker = "Ubermacht", price = 39500, label = "Ubermacht Sentinel Classic Custom", model = "sentinel6str2"},
            {maker = "Ubermacht", price = 34500, label = "Ubermacht Sentinel SG4 Drift Missile", model = "SENTINELDM"},
            {maker = "Ubermacht", price = 56500, label = "Übermacht Zion V10", model = "ZIONV10"},
            {maker = "Ubermacht", price = 45000, label = "Cypher MX-2", model = "cypherx9"},
        }
    },
    {
        label = "VAPID",
        vehs = {
            {maker = "VAPID", price = 265000, label = "Custom FMJ Bullet", model = "fmjb"},
            {maker = "VAPID", price = 47500, label = "Vapid Contender Baja", model = "CONTENDERBAJA"},
            {maker = "VAPID", price = 33500, label = "2022 Vapid Caracara", model = "CARACARAN"},
            {maker = "VAPID", price = 48500, label = "Vapid Torrence", model = "torrence"},
            {maker = "VAPID", price = 97500, label = "Vapid Dominator GT Coupe", model = "DOMGTCOUPE"},
            {maker = "Vapid", price = 220000, label = "Vamos Custom", model = "vamoswb"},
            {maker = "VAPID", price = 88500, label = "Vapid Sandstorm D350", model = "NSANDSTORM"},
            {maker = "VAPID", price = 88500, label = "Sandstorm D350", model = "nsandstorm"},
            {maker = "VAPID", price = 88500, label = "Sandstorm D350 XL", model = "nsandstorm2"},
            {maker = "VAPID", price = 88500, label = "Sandstorm D350 Hellenbach", model = "hellenstorm"},
            {maker = "VAPID", price = 88500, label = "Vapid Sandstorm v1", model = "sandstorm"},
            {maker = "VAPID", price = 88500, label = "Vapid Sandstorm v2", model = "sandstormxl"},
            {maker = "VAPID", price = 88500, label = "Vapid Sandstorm v3", model = "sandstormev"},
            {maker = "VAPID", price = 88500, label = "Vapid Benson V2", model = "benson2"},
            {maker = "VAPID", price = 88500, label = "Vapid Speedoo v2", model = "nspeedo"},
            {maker = "VAPID", price = 88500, label = "Vapid executioner", model = "executioner"},
            {maker = "VAPID", price = 37500, label = "Vapid Dominator 450ci", model = "dominatorgtc"},
            {maker = "VAPID", price = 49500, label = "Vapid Clique v2", model = "clique2"},
            {maker = "VAPID", price = 33500, label = "Vapid Dominator 550ci", model = "domc"},
            {maker = "VAPID", price = 18500, label = "Vapid Contender Custom", model = "CONTENDERC"},
            {maker = "VAPID", price = 335000, label = "Vapid Nightmare GT", model = "domgt"},
            {maker = "VAPID", price = 22850, label = "Vapid Bobcat CTX (Bagcat)", model = "bcatctx"},
            {maker = "VAPID", price = 33500, label = "Vapid Riata CTX", model = "gstriata1"},
            {maker = "VAPID", price = 19500, label = "Vapid Riata Outlaw", model = "RIATAO"},
        }
    },
    {
        label = "VULCAR",
        vehs = {
            {maker = "VULCAR", price = 375000, label = "Vulcar Hachura R Custom", model = "HACHURAC"},
            {maker = "VULCAR", price = 285000, label = "Vulcar Nebula Wagon", model = "NEBULAW"},
        }
    },
    {
        label = "Vigero",
        vehs = {
            {maker = "Vigero", price = 93500, label = "Vigero ZX WideBody", model = "vigerozxwbc"},
            {maker = "Vigero", price = 93500, label = "VigeroZX WideBody Convertible", model = "vigerozxwb"},
        }
    },
    {
        label = "Willard",
        vehs = {
            {maker = "Willard", price = 65000, label = "Willard Elegant", model = "elegant"},
            {maker = "Willard", price = 37500, label = "Willard Paradox", model = "paradox"},
            {maker = "Willard", price = 28500, label = "Willard Paradox (HotRing)", model = "paradox2"},
        }
    },
    {
        label = "Warrener",
        vehs = {
            {maker = "Warrener", price = 16500, label = "Warrener HKR WideBody", model = "warrener3"},
        }
    },
}
--{maker = "replace", price = replace, label = "replace", model = "replace"},

local backToLobby = false
local open = false
local ownedVehicles = {}
local selectedSub = {}
local previewVeh = {
    entity = 0,
    model = ""
}
local SelectedModel = ""
local previewEntitys = {}
local previewCoords = vector4(-44.621406555176, -1096.7896728516, 26.422359466553, 118.64887237549)
local vehShopCoords = vector3(-43.162559509277, -1100.0212402344, 26.422359466553)
local camPos = vector3(-45.922637939453, -1102.5314941406, 27.422361373901)
local main = RageUI.CreateMenu("DriftV", "~b~Drift vehicles shop")
local sub = RageUI.CreateSubMenu(main, "DriftV", "~b~Drift vehicles shop")
local sellSub = RageUI.CreateSubMenu(main, "Sell Vehicle", "~b~Sell your vehicles")

main.Closed = function()
    open = false
    RageUI.CloseAll()
    RageUI.Visible(main, false)
    DeleteEntity(previewVeh.entity)
    cam.render("SHOP", false, false, 0)
    cam.delete("SHOP")

    if backToLobby then
        EnableLobby()
    end
end

main.WidthOffset = 125.0
sub.WidthOffset = 125.0
sellSub.WidthOffset = 125.00

function OpenVehShopMenu(GoBackToLobby)
    if open then
        open = false
        RageUI.Visible(main, false)
    else
        if GoBackToLobby ~= nil and GoBackToLobby == true then
            backToLobby = true
        else
            backToLobby = false
        end

        open = true
        RageUI.Visible(main, true)
        cam.create("SHOP")
        cam.setPos("SHOP", camPos)
        cam.setFov("SHOP", 40.0)
        cam.lookAtCoords("SHOP", previewCoords.xyz)
        cam.setActive("SHOP", true)
        cam.render("SHOP", true, false, 0)

        -- Fetch vehicles when opening the "Sell Vehicle" menu
        TriggerServerEvent("drift:FetchVehicles")
        Citizen.CreateThread(function()
            while open do
                RageUI.IsVisible(main, function()
                    RageUI.Button("Money: ~g~$"..GroupDigits(tostring(p:GetMoney())) .. "", nil, {}, true, {})
                    RageUI.Button("Sell Vehicle", nil, {RightLabel = ">"}, true, {}, sellSub)
                    for k,v in pairs(vehs) do
                        RageUI.Button(v.label, nil, {RightLabel = ">"}, true, {
                            onSelected = function()
                                selectedSub = k
                            end,
                        }, sub);
                    end
                end)

                RageUI.IsVisible(sub, function()
                    for k,v in pairs(vehs[selectedSub].vehs) do
                        RageUI.Button(v.maker.." "..v.label, nil, {RightLabel = "~g~"..GroupDigits(v.price).."~s~$"}, true, {
                            onSelected = function()
                                -- Check if the player already owns this vehicle
                                local alreadyOwned = false
                                for _, car in ipairs(ownedVehicles) do
                                    if car.model == v.model then
                                        alreadyOwned = true
                                        break
                                    end
                                end

                                if alreadyOwned then
                                    ShowNotification("You already own this vehicle!")
                                else
                                    if v.price <= p:GetMoney() then
                                        open = false
                                        RageUI.CloseAll()
                                        RageUI.Visible(main, false)
                                        DeleteEntity(previewVeh.entity)
                                        cam.render("SHOP", false, false, 0)
                                        cam.delete("SHOP")
                                        TriggerServerEvent(Events.buyVeh, v.price, v.maker.." "..v.label, v.model)
                                        ShowHelpNotification("Your new vehicle has been added to your garage! To take it out, use F1 -> My vehicles !", true)

                                        if backToLobby then
                                            EnableLobby()
                                        end
                                    else
                                        ShowNotification("Not enough money")
                                    end
                                end
                            end,
                            onActive = function()
                                if SelectedModel ~= v.model and not isCreatingVehicle then
                                    SelectedModel = v.model
                                    isCreatingVehicle = true
                                    Citizen.CreateThread(function()
                                        for _, entity in pairs(previewEntitys) do
                                            DeleteEntity(entity)
                                        end
                                        previewEntitys = {}

                                        local veh = entity:CreateVehicleLocal(SelectedModel, previewCoords.xyz, previewCoords.w)
                                        local vehId = veh:getEntityId()

                                        table.insert(previewEntitys, vehId)
                                        SetVehicleOnGroundProperly(vehId)
                                        FreezeEntityPosition(vehId, true)
                                        SetVehicleDirtLevel(vehId, 0.0)

                                        previewVeh.entity = vehId
                                        previewVeh.model = SelectedModel

                                        isCreatingVehicle = false
                                    end)
                                end
                            end
                        }, sub);
                    end
                end)

                RageUI.IsVisible(sellSub, function()
                    if #ownedVehicles > 0 then
                        for _, car in ipairs(ownedVehicles) do
                            RageUI.Button(car.label, nil, {RightLabel = "~g~$" .. GroupDigits(math.floor(car.price / 2))}, true, {
                                onSelected = function()
                                    TriggerServerEvent(Events.sellVeh, car.model) -- Trigger sell event
                
                                    -- Transition back to the main Drift Vehicle Shop menu
                                    RageUI.CloseAll() -- Close all menus
                                    Wait(200) -- Small delay to ensure clean transition
                                    RageUI.Visible(main, true) -- Reopen the main menu
                                end,
                                onActive = function()
                                    if SelectedModel ~= car.model and not isCreatingVehicle then
                                        SelectedModel = car.model
                                        isCreatingVehicle = true
                                        Citizen.CreateThread(function()
                                            for _, entity in pairs(previewEntitys) do
                                                DeleteEntity(entity)
                                            end
                                            previewEntitys = {}
                
                                            local veh = entity:CreateVehicleLocal(SelectedModel, previewCoords.xyz, previewCoords.w)
                                            local vehId = veh:getEntityId()
                
                                            table.insert(previewEntitys, vehId)
                                            SetVehicleOnGroundProperly(vehId)
                                            FreezeEntityPosition(vehId, true)
                                            SetVehicleDirtLevel(vehId, 0.0)
                
                                            previewVeh.entity = vehId
                                            previewVeh.model = SelectedModel
                
                                            isCreatingVehicle = false
                                        end)
                                    end
                                end
                            })
                        end
                    else
                        RageUI.Button("You don't Own any vehicles", nil, {}, false, {})
                    end
                end)
                
                Wait(1)
            end
        end)
    end
end

-- Listen for server response and update ownedVehicles
RegisterNetEvent("drift:ReceiveVehicles")
AddEventHandler("drift:ReceiveVehicles", function(carList)
    ownedVehicles = carList or {}
end)

Citizen.CreateThread(function()
    while zone == nil do Wait(1) end

    zone.addZone("veh_shop", vehShopCoords, "Press ~INPUT_CONTEXT~ to open vehicle shop", function() OpenVehShopMenu() end, true, 36, 1.0, {133, 255, 92}, 170)
    AddBlip(vehShopCoords, 326, 2, 0.85, 17, "Drift vehicle shop")
end)